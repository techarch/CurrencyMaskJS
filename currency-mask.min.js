function _MaskAPI(){this.version="0.8";this.instances=0;this.objects={}}MaskAPI=new _MaskAPI;function Mask(a,c,b){this.mask=a;this.type="string"==typeof c?c:"string";this.error=[];this.errorCodes=[];this.value="";this.logLevel="info";this.strippedValue="";this.allowPartial=!1;this.id=MaskAPI.instances++;this.ref="MaskAPI.objects['"+this.id+"']";this.round="undefined"!=typeof b?b:!0;MaskAPI.objects[this.id]=this}
Mask.prototype.attach=function(a){var c=navigator.userAgent;this.msie=c.match(/MSIE/g)||c.match(/Trident/);this.msie9AndAbove=!1;if(this.msie){var b=1;null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(c)&&(b=parseFloat(RegExp.$1));this.msie9AndAbove=9<=b||c.match(/Trident/)}this.webkit=c.match(/WebKit/g);$addEvent(a,"onkeydown","return "+this.ref+".isAllowKeyPress(event, this);",!0);$addEvent(a,"onkeyup","return "+this.ref+".getKeyPress(event, this);",!0);this.target=a;var e=this;this.msie9AndAbove||this.webkit?
$(a).blur(function(){$(this).change();e.log("Mask "+e+" for input: #"+this.id+" triggered change event","info");return!0}):$addEvent(a,"onblur","this.value = "+this.ref+".format(this.value);"+this.ref+".target.value=this.value;return this.value;",!0);this.log("Mask "+this.mask+" now attached to input: #"+a.id,"debug")};Mask.prototype.isAllowKeyPress=function(a,c){if("string"!=this.type)return!0;var b=new qEvent(a);return 47<b.keyCode&&c.value.length>=this.mask.length&&!b.ctrlKey?!1:!0};
Mask.prototype.getKeyPress=function(a,c,b){this.allowPartial=!0;a=new qEvent(a);var e=this.getCaretPosition(c),h=c.value.length;if(47<a.keyCode||1==b||8==a.keyCode||46==a.keyCode){var g=c.value,f;f=8==a.keyCode||46==a.keyCode||190==a.keyCode?!0:!1;"number"==this.type?(this.log("Mask for "+c.id+" type:"+this.type+" _u:"+b+" key:"+a.keyCode+" decoded:"+String.fromCharCode(a.keyCode)+" setNumber("+g+","+f+")","debug"),this.value=this.setNumber(g,f)):this.value="date"==this.type?this.setDateKeyPress(g,
f):this.setGeneric(g,f);c.value=this.value;this.setCaretPosition(c,c.value.length>h?e+1:e);this.log("Mask for "+c.id+" type:"+this.type+" _u:"+b+" key:"+a.keyCode+" decoded:"+String.fromCharCode(a.keyCode)+" new value:"+c.value,"debug")}else this.log("Mask for "+c.id+" _u:"+b+" key:"+a.keyCode+" decoded:"+String.fromCharCode(a.keyCode)+" ignore","debug");this.allowPartial=!1;return!0};
Mask.prototype.getCaretPosition=function(a){var c=0,b=null,e=null;if(this.msie){if("undefined"!=typeof document.selection)b=document.selection,e=b.createRange();else if(b=window.getSelection(),null!=b&&(e=0<b.rangeCount?b.getRangeAt(0):null,null==e))return 0;c=e.text.length;e.moveStart("character",-a.value.length);c=e.text.length-c;caretEnd=c+e.text.length}else if(a.selectionStart||"0"==a.selectionStart)c=a.selectionStart;return c};
Mask.prototype.setCaretPosition=function(a,c){var b=null,e=null;if(this.msie)"undefined"!=typeof document.selection?(b=document.selection,e=b.createRange(),e.moveStart("character",-a.value.length),e.collapse(!0),e.moveEnd("character",c),e.moveStart("character",c),e.select()):(b=window.getSelection(),null!=b&&(e=0<b.rangeCount?b.getRangeAt(0):null,null!=e&&(b.removeAllRanges(),b.addRange(c))));else if(a.selectionStart||"0"==a.selectionStart)a.selectionStart=c,a.selectionEnd=c};
Mask.prototype.format=function(a,c){return this.value="number"==this.type?this.setNumber(a):"date"==this.type?this.setDate(a):this.setGeneric(a)};Mask.prototype.throwError=function(a,c,b){this.error[this.error.length]=c;this.errorCodes[this.errorCodes.length]=a;return"string"==typeof b?b:!0};
Mask.prototype.setGeneric=function(a,c){var b,e=this.mask,h=[],g="",f,n,l=[],m=0,q={x:"A-Za-z","#":"0-9","*":"A-Za-z0-9"};b=a.replace(new RegExp("[^"+q["*"]+"]","gi"),"");1==c&&b.length==this.strippedValue.length&&(b=b.substring(0,b.length-1));this.strippedValue=b;for(var p=0;p<e.length;p++){n=e.charAt(p);f=-1<"x#*".indexOf(n);"!"==n&&(n=e.charAt(p++));if(f&&!this.allowPartial||f&&this.allowPartial&&h.length<b.length)h[h.length]="["+q[n]+"]";l[l.length]={chr:n,mask:f}}e=!1;if(!this.allowPartial&&
!(new RegExp(h.join(""))).test(b))return this.throwError(1,'The value "'+a+'" must be in the format '+this.mask+".",a);if(this.allowPartial&&0<b.length||!this.allowPartial)for(p=0;p<l.length;p++){if(l[p].mask){for(;0<b.length&&!(new RegExp(h[m])).test(b.charAt(m));)b=1==b.length?"":b.substring(1);0<b.length&&(g+=b.charAt(m),e=!0);m++}else g+=l[p].chr;if(this.allowPartial&&m>b.length)break}this.allowPartial&&!e&&(g="");this.allowPartial&&(this.nextValidChar=g.length<l.length?q[l[g.length].chr]:null);
return g};
Mask.prototype.setNumber=function(a,c){var b=String(a).replace(/[^\d.-]*/gi,""),e=this.mask;if(("+"==b||"-"==b)&&-1==e.indexOf(b))return"";0<this.value.length&&(-1!=b.indexOf("+")||-1!=b.indexOf("-"))&&(b=b.replace(/\+/g,""),b=b.replace(/\-/g,""));b=b.replace(/\+/,"d").replace(/\+/g,"").replace(/d/,"+");b=b.replace(/\-/,"d").replace(/\-/g,"").replace(/d/,"-");b=b.replace(/\./,"d").replace(/\./g,"").replace(/d/,".");if(!/^[\$]?((\$?[\+-]?([0#]{1,3},)?[0#]*(\.[0#]*)?)|([\+-]?\([\+-]?([0#]{1,3},)?[0#]*(\.[0#]*)?\)))$/.test(e))return this.throwError(1,"An invalid mask was specified for the \nMask constructor.",
a);1==c&&b.length==this.strippedValue.length&&(b=b.substring(0,b.length-1));if(this.allowPartial&&0==b.replace(/[^0-9]/,"").length)return b;this.strippedValue=b;0==b.length&&(b=NaN);var h=Number(b);if(isNaN(h))return this.throwError(2,"The value entered was not a number.",a);if(0==e.length)return b;var g=String(Math.abs(-1<b.indexOf(".")?b.split(".")[0]:b)),f=-1<b.indexOf(".")?b.split(".")[1]:"",n=f,l=0!=h&&-1*Math.abs(h)==h,h={$:/^[\$]/.test(e),"(":l&&-1<e.indexOf("("),"+":-1!=e.indexOf("+")&&!l};
h["-"]=l&&(!h["("]||-1!=e.indexOf("-"));e=e.replace(/[^#0.,]*/gi,"");l=-1<e.indexOf(".")?e.split(".")[1]:"";if(0==l.length)g=String(Math.round(Number(g))),f="";else{var m=l.lastIndexOf("0")+1;if(f.length>l.length)this.round?(f="1"+f.substring(0,l.length+1),f=Math.round(Number(f)/10),f=String(f).substring(1)):f=f.substring(0,l.length);else for(;f.length<m;)f+="0"}var m=-1<e.indexOf(".")?e.split(".")[0]:e,m=m.replace(/[^0#]+/gi,""),q=m.indexOf("0")+1;if(0<q)for(q=m.length-q+1;g.length<q;)g="0"+g;this.strippedValue=
g+"."+f;if(/[#0]+,[#0]{3}/.test(e)){e=[];m=0;for(g=Number(g);999<g;)e[m]="00"+String(g%1E3),e[m]=e[m].substring(e[m].length-3),g=Math.floor(g/1E3),m++;e[m]=String(g%1E3);g=e.reverse().join(",")}b=0<f.length&&!this.allowPartial||0<l.length&&this.allowPartial&&-1<b.indexOf(".")&&n.length>=f.length?g+"."+f:0<l.length&&this.allowPartial&&-1<b.indexOf(".")&&n.length<f.length?g+"."+n:g;h.$&&(b=this.mask.replace(/(^[\$])(.+)/gi,"$")+b);h["+"]&&(b="+"+b);h["-"]&&(b="-"+b);h["("]&&(b="("+b+")");return b};
Mask.prototype.setDate=function(a){var c=this.mask,b,e,h,g,f,n;b=c.split(/[^mdy]+/);n=c.split(/[mdy]+/);e=a.split(/[^0-9]/);0==n[0].length&&n.splice(0,1);for(var l=0;l<b.length;l++)c=b[l].charAt(0).toLowerCase(),"m"==c?h=parseInt(e[l],10)-1:"d"==c?g=parseInt(e[l],10):"y"==c&&(f=parseInt(e[l],10));3>String(f).length&&(f=2E3+f,(new Date).getFullYear()+5<f&&(f-=100));f=new Date(f,h,g);if(f.getDate()!=g)return this.throwError(1,"An invalid day was entered.",a);if(f.getMonth()!=h)return this.throwError(2,
"An invalid month was entered.",a);a="";for(l=0;l<b.length;l++)c=b[l].charAt(0).toLowerCase(),"m"==c?(h++,2==b[l].length&&(h="0"+h,h=h.substring(h.length-2)),a+=h):"d"==c?(2==b[l].length&&(g="0"+g,g=g.substring(g.length-2)),a+=g):"y"==c&&(a=2==b[l].length?a+f.getYear():a+f.getFullYear()),l<b.length-1&&(a+=n[l]);return a};
Mask.prototype.setDateKeyPress=function(a,c){var b=a,e=this.mask,h=b.charAt(b.length-1),g,f,n,l,m="",q="",p="",t,k,u;if(1==c){for(;/[^0-9]/gi.test(b.charAt(b.length-1));)b=b.substring(0,b.length-1);/[^0-9]/gi.test(this.strippedValue.charAt(this.strippedValue.length-1))&&(b=b.substring(0,b.length-1));if(0==b.length)return""}g=e.split(/[^mdy]/);s=e.split(/[mdy]+/);for(k=0;k<s.length;k++)0==s[k].length&&(s.splice(k,1),k-=1);b=b.split(/[^0-9]/);for(k=0;k<b.length;k++)0==b[k].length&&(b.splice(k,1),k-=
1);k=0<b.length?b.length-1:0;f=g[k].charAt(0);n=g[k].length;for(k=0;k<b.length;k++)t=g[k].charAt(0).toLowerCase(),"m"==t?m=parseInt(b[k],10)-1:"d"==t?q=parseInt(b[k],10):"y"==t&&(p=parseInt(b[k],10));var r="";for(k=0;k<b.length;k++){t=g[k].charAt(0).toLowerCase();if("m"==t){u=/[^0-9]/.test(h)&&"m"==f;m++;if(2==b[k].length&&10>m||2==g[k].length&&"m"!=f||1<m&&"m"==f||u&&2==g[k].length)m="0"+m,m=m.substring(m.length-2);l=String(m).length;n=2;r+=m}else if("d"==t){u=/[^0-9]/.test(h)&&"d"==f;if(2==b[k].length&&
10>q||2==g[k].length&&"d"!=f||3<q&&"d"==f||u&&2==g[k].length)q="0"+q,q=q.substring(q.length-2);l=String(q).length;n=2;r+=q}else if("y"==t){u=/[^0-9]/.test(h)&&"y"==f;p="y"==f?String(p):2==g[k].length?d.getYear():d.getFullYear();if(2==b[k].length&&10>p||2==g[k].length&&"y"!=f||u&&2==g[k].length)p="0"+p,p=p.substring(p.length-2);n=g[k].length;l=String(p).length;r+=p}if((n==l||u)&&t==f&&k<s.length||k<s.length&&t!=f)r+=s[k]}r.length>e.length&&(r=r.substring(0,e.length));return this.strippedValue="NaN"==
r?"":r};Mask.prototype.updateFormattedValue=function(a){a=this.format(a);return this.target.value=a};
Mask.prototype.log=function(a,c){if(this.webkit){switch(c){case "debug":if("debug"===this.logLevel)try{console.debug(a)}catch(b){}break;case "error":try{console.error(a)}catch(e){}break;case "info":if("debug"===this.logLevel||"info"===this.logLevel)try{console.info(a)}catch(h){}break;default:try{console.debug(a)}catch(g){}}return a}if(this.msie&&(c===this.logLevel||"debug"===this.logLevel||"info"===this.logLevel&&("info"===c||"error"===c)))try{console.log(a)}catch(f){}return a};
function qEvent(a){if(navigator.userAgent.match(/MSIE/g))a=window.event,this.keyCode=parseInt(a.keyCode,10),this.button=a.button,this.srcElement=a.srcElement,this.type=a.type,document.all?(this.x=a.clientX+document.body.scrollLeft,this.y=a.clientY+document.body.scrollTop):(this.x=a.clientX,this.y=a.clientY),this.screenX=a.screenX,this.screenY=a.screenY,this.altKey=a.altKey,this.ctrlKey=a.ctrlKey,this.shiftKey=a.shiftKey;else{var c="key"==a.type.substring(0,3);this.keyCode=c?parseInt(a.which,10):0;
this.button=c?0:parseInt(a.which,10);this.srcElement=a.target;this.type=a.type;this.x=a.pageX;this.y=a.pageY;this.screenX=a.screenX;this.screenY=a.screenY;document.layers?(this.altKey=0<(a.modifiers&Event.ALT_MASK),this.ctrlKey=0<(a.modifiers&Event.CONTROL_MASK),this.shiftKey=0<(a.modifiers&Event.SHIFT_MASK),this.keyCode=this.translateKeyCode(this.keyCode)):(this.altKey=a.altKey,this.ctrlKey=a.ctrlKey,this.shiftKey=a.shiftKey)}0==this.button&&(this.setKeyPressed(this.keyCode),this.keyChar=String.fromCharCode(this.keyCode))}
qEvent.prototype.translateKeyCode=function(a){var c={};if(document.layers){if(96<this.keyCode&&123>this.keyCode)return this.keyCode-32;c={96:192,126:192,33:49,64:50,35:51,36:52,37:53,94:54,38:55,42:56,40:57,41:48,92:220,124:220,125:221,93:221,91:219,123:219,39:222,34:222,47:191,63:191,46:190,62:190,44:188,60:188,45:189,95:189,43:187,61:187,59:186,58:186,"null":null}}return c[a]?c[a]:a};
qEvent.prototype.setKP=function(a,c){this.keyPressedCode=a;this.keyPressed=(this.keyNonChar="string"==typeof c)?c:String.fromCharCode(a);this.isNumeric=parseInt(this.keyPressed,10)==this.keyPressed;this.isAlpha=64<this.keyCode&&91>this.keyCode&&!this.altKey&&!this.ctrlKey;return!0};
qEvent.prototype.setKeyPressed=function(a){var c=this.shiftKey;if(!c&&64<a&&91>a)return this.setKP(a+32);if(95<a&&106>a)return this.setKP(a-48);switch(a){case 49:case 51:case 52:case 53:c&&(a-=16);break;case 50:c&&(a=64);break;case 54:c&&(a=94);break;case 55:c&&(a=38);break;case 56:c&&(a=42);break;case 57:c&&(a=40);break;case 48:c&&(a=41);break;case 192:a=c?126:96;break;case 189:a=c?95:45;break;case 187:a=c?43:61;break;case 220:a=c?124:92;break;case 221:a=c?125:93;break;case 219:a=c?123:91;break;
case 222:a=c?34:39;break;case 186:a=c?58:59;break;case 191:a=c?63:47;break;case 190:a=c?62:46;break;case 188:a=c?60:44;break;case 106:case 57379:a=42;break;case 107:case 57380:a=43;break;case 109:case 57381:a=45;break;case 110:a=46;break;case 111:case 57378:a=47;break;case 8:return this.setKP(a,"[backspace]");case 9:return this.setKP(a,"[tab]");case 13:return this.setKP(a,"[enter]");case 16:case 57389:return this.setKP(a,"[shift]");case 17:case 57390:return this.setKP(a,"[ctrl]");case 18:case 57388:return this.setKP(a,
"[alt]");case 19:case 57402:return this.setKP(a,"[break]");case 20:return this.setKP(a,"[capslock]");case 32:return this.setKP(a,"[space]");case 91:return this.setKP(a,"[windows]");case 93:return this.setKP(a,"[properties]");case 33:case 57371:return this.setKP(-1*a,"[pgup]");case 34:case 57372:return this.setKP(-1*a,"[pgdown]");case 35:case 57370:return this.setKP(-1*a,"[end]");case 36:case 57369:return this.setKP(-1*a,"[home]");case 37:case 57375:return this.setKP(-1*a,"[left]");case 38:case 57373:return this.setKP(-1*
a,"[up]");case 39:case 57376:return this.setKP(-1*a,"[right]");case 40:case 57374:return this.setKP(-1*a,"[down]");case 45:case 57382:return this.setKP(-1*a,"[insert]");case 46:case 57383:return this.setKP(-1*a,"[delete]");case 144:case 57400:return this.setKP(-1*a,"[numlock]")}return 111<a&&124>a?this.setKP(-1*a,"[f"+(a-111)+"]"):this.setKP(a)};
function $addEvent(a,c,b,e){c=c.toLowerCase();e="boolean"==typeof e?e:!0;var h=a[c]?a[c].toString():"",h=h.substring(h.indexOf("{")+1,h.lastIndexOf("}")),h=(e?h+b:b+h)+"\n";return a[c]=window.Event?new Function("event",h):new Function(h)};